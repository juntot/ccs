const videoElem=document.querySelector("video"),controller=new AbortController;let scanner="";function scanQRCode(e){(scanner=new QrScanner(e,e=>setResult(e),{onDecodeError:e=>{},highlightScanRegion:!0,highlightCodeOutline:!0})).start().then(()=>{QrScanner.listCameras(!0).then(e=>e.forEach(e=>{}))})}async function setResult(e){const t=await localStorage.getItem("qrlog"),a=await localStorage.getItem("qrlogdate");let n=0;if(t){const e=moment(moment(new Date(a)).format("YYYY-MM-DD hh:mm:ss A"),"YYYY-MM-DD hh:mm:ss A");n=moment(moment(new Date).format("YYYY-MM-DD hh:mm:ss A"),"YYYY-MM-DD hh:mm:ss A").diff(e,"seconds")}let s=toastMessage(e.data,"You just recently logged. please wait after 3 minutes..");if(e.data==t&&n<180)return $(".toastList").html(s),$(".toast").toast({animation:!1,delay:3e3}),void $(".toast").toast("show");scanner._active=!1;try{const t=await axios.get("scan-qr/"+e.data,{signal:controller.signal});await localStorage.setItem("qrlog",t.data.userId),await localStorage.setItem("qrlogdate",t.data.date_created);const a="public/assets/img/default-avatar.png",n=await t.data.avatar?"storage/app/"+t.data.avatar:a;(new Image).src=await n,await loadProfile(t.data),scanner._active=!0,scanner._scanFrame()}catch(t){s=toastMessage(e.data,t.response.data.message),$(".toastList").html(s),$(".toast").toast({animation:!1,delay:3e3}),$(".toast").toast("show"),scanner._active=!0,scanner._scanFrame()}}async function loadProfile(e){const t=e?"storage/app/"+e.avatar:"public/assets/img/default-avatar.png";return await $(".avatar-profile").attr("src",t),await $(".user-name").text(e?e.fullname:""),await $(".user-section").text(e?e.section:""),await $(".logtime").html(e?'<span class="logStatus" style="text-transform: capitalize;">Log '+e.status+'</span> - <span style="text-transform: uppercase;">'+moment(new Date(e.date_created)).format("HH:mm a")+"</span>":""),!0}function toastMessage(e,t){return`\n      <div class="toast" role="alert" aria-live="assertive" aria-atomic="true">  \n        <div class="toast-body text-light bg-danger">\n          <div class="toast-header custom-toast-header text-light">\n            <strong class="mr-auto">ID No: ${e}</strong>\n            <small class="text-light"></small>\n            <button type="button" class="ml-2 mb-1 close text-light" data-dismiss="toast" aria-label="Close">\n              <span aria-hidden="true">&times;</span>\n            </button>\n          </div>\n          <div class="toast-msg">\n          ${t}\n          </div>\n        </div>\n      </div>`}videoElem&&scanQRCode(videoElem),$("#stopscan").click(function(e){$("#hero").css("opacity",1),scanner.stop()}),$("#startscan").click(function(e){$("#hero").css("opacity",0),scanner.start()}),$("#fullscreen").click(function(){$(this).find("i").hasClass("bx-fullscreen")?($(this).find("i").removeClass("bx-fullscreen"),$(this).find("i").addClass("bx-exit-fullscreen"),$(this).find("span").text(" Exit Full Screen")):($(this).find("i").removeClass("bx-exit-fullscreen"),$(this).find("i").addClass("bx-fullscreen"),$(this).find("span").text(" Full Screen")),document.fullScreenElement&&null!==document.fullScreenElement||!document.mozFullScreen&&!document.webkitIsFullScreen?document.documentElement.requestFullScreen?document.documentElement.requestFullScreen():document.documentElement.mozRequestFullScreen?document.documentElement.mozRequestFullScreen():document.documentElement.webkitRequestFullScreen&&document.documentElement.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT):document.cancelFullScreen?document.cancelFullScreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen()});